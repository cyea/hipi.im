<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nodejs 爬取one和墨迹天气定时发邮件 | HIPI</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/hipi.svg">
    <meta name="description" content="技术日志">
    <link rel="preload" href="/assets/css/0.styles.f50210c2.css" as="style"><link rel="preload" href="/assets/js/app.3c4192dc.js" as="script"><link rel="preload" href="/assets/js/7.09f10cf6.js" as="script"><link rel="preload" href="/assets/js/15.55f1b48f.js" as="script"><link rel="prefetch" href="/assets/js/1.70410de1.js"><link rel="prefetch" href="/assets/js/10.4efc20c2.js"><link rel="prefetch" href="/assets/js/11.d167edb8.js"><link rel="prefetch" href="/assets/js/12.334bf9e8.js"><link rel="prefetch" href="/assets/js/13.643ea81f.js"><link rel="prefetch" href="/assets/js/14.a0b4dee7.js"><link rel="prefetch" href="/assets/js/3.6874a020.js"><link rel="prefetch" href="/assets/js/4.6ac7ae0e.js"><link rel="prefetch" href="/assets/js/5.e59975f6.js"><link rel="prefetch" href="/assets/js/6.e4a11c47.js"><link rel="prefetch" href="/assets/js/8.f0388794.js"><link rel="prefetch" href="/assets/js/9.184815ea.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f50210c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-meteorlxy"><header class="header" data-v-7a046aea><div data-v-e4145d0a data-v-7a046aea><nav class="navbar" data-v-e4145d0a><div class="container" data-v-e4145d0a><a href="/" class="router-link-active" data-v-e4145d0a><span class="navbar-site-name" data-v-e4145d0a>
          HIPI
        </span></a> <div class="navbar-toggler" data-v-e4145d0a><svg class="icon" style="font-size:1.2em;" data-v-e4145d0a data-v-e4145d0a><title data-v-e4145d0a data-v-e4145d0a>menu</title><use xlink:href="#icon-menu" data-v-e4145d0a data-v-e4145d0a></use></svg></div> <div class="navbar-links" data-v-e4145d0a><a href="/" class="navbar-link" data-v-e4145d0a>
            主页
          </a><a href="/posts/" class="navbar-link router-link-active" data-v-e4145d0a>
            博文
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-e4145d0a></div></div> <div class="banner" data-v-98d6aa8c data-v-7a046aea data-v-7a046aea><div class="container" data-v-98d6aa8c><div class="center" data-v-98d6aa8c><h1 data-v-98d6aa8c data-v-7a046aea>
          Nodejs 爬取one和墨迹天气定时发邮件
        </h1></div></div></div></header> <div class="container clearfix show-aside" data-v-4dd605a1 data-v-4dd605a1><main class="main" data-v-4dd605a1><div class="post" data-v-4dd605a1 data-v-4dd605a1><section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      发布时间 : 2019-04-10
    </span> <span class="update-date" data-v-4e23451f>
      最后修改 : 2020-08-11
    </span></section> <section class="post-links" data-v-4e23451f><a href="/posts/2019/01/21/a.html" class="post-link" data-v-4e23451f>
      上一篇 : Hello, world!
    </a> <!----></section></section> <article class="main-div"><div class="post-content content content__default"><blockquote><p>根据用户配置 爬取 one 和不同地区墨迹天气 每天定时发邮件，支持多人地区个性化定制 可以的话 可以去<code>https://github.com/cyea/email-bot</code> 给个小星星</p></blockquote> <h2 id="效果展示"><a href="#效果展示" class="header-anchor">#</a> 效果展示</h2> <p><img src="https://i.loli.net/2019/04/09/5cac0c1ca75f1.png" alt=""> <img src="https://i.loli.net/2019/04/10/5cadac38610bd.jpg" alt=""></p> <h2 id="如何快速使用"><a href="#如何快速使用" class="header-anchor">#</a> 如何快速使用</h2> <h3 id="_1-拉取代码安装依赖"><a href="#_1-拉取代码安装依赖" class="header-anchor">#</a> 1. 拉取代码安装依赖</h3> <p><strong>这里使用<code>yarn</code>作为包管理器</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/cyea/email-bot.git
<span class="token builtin class-name">cd</span> email-bot
<span class="token function">yarn</span>
</code></pre></div><h3 id="_2-配置"><a href="#_2-配置" class="header-anchor">#</a> 2. 配置</h3> <h4 id="①-修改发送者邮箱账号密码敏感配置"><a href="#①-修改发送者邮箱账号密码敏感配置" class="header-anchor">#</a> ① 修改发送者邮箱账号密码敏感配置</h4> <p>新建<code>.env</code>文件 格式是跟<code>.env.example</code> 一样的 <strong>填入自己的邮箱账号密码及邮件提供商</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>NODE_ENV <span class="token operator">=</span> production <span class="token comment">#正式环境精简代码所用</span>
EmianService <span class="token operator">=</span> outlook <span class="token comment">#邮件提供商 支持列表：https://nodemailer.com/smtp/well-known/</span>
EamilAuth_user <span class="token operator">=</span> xxxx@outlook.com <span class="token comment">#发送者邮箱地址</span>
EamilAuth_pass <span class="token operator">=</span> xxxxxxxxx <span class="token comment"># smtp 授权码</span>
</code></pre></div><h4 id="②-修改其他不敏感配置"><a href="#②-修改其他不敏感配置" class="header-anchor">#</a> ② 修改其他不敏感配置</h4> <p>修改<code>config/index.js</code>里的配置文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> env <span class="token punctuation">}</span> <span class="token operator">=</span> process
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">ONE</span><span class="token operator">:</span> <span class="token string">'http://wufazhuce.com/'</span><span class="token punctuation">,</span> <span class="token comment">// ONE的web版网站</span>
  <span class="token constant">MOJI_HOST</span><span class="token operator">:</span> <span class="token string">'https://tianqi.moji.com/weather/china/'</span><span class="token punctuation">,</span> <span class="token comment">// 中国墨迹天气url,</span>
  EmianService<span class="token operator">:</span> env<span class="token punctuation">.</span>EmianService<span class="token punctuation">,</span> <span class="token comment">// 发送者邮箱厂家</span>
  EamilAuth<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 发送者邮箱账户用户名及密码</span>
    user<span class="token operator">:</span> env<span class="token punctuation">.</span>EamilAuth_user<span class="token punctuation">,</span>
    pass<span class="token operator">:</span> env<span class="token punctuation">.</span>EamilAuth_pass<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  EmailFrom<span class="token operator">:</span> <span class="token string">'yuyehack@outlook.com'</span><span class="token punctuation">,</span> <span class="token comment">// 发送者昵称与邮箱地址</span>
  EmailSubject<span class="token operator">:</span> <span class="token string">'一封暖暖的小邮件'</span><span class="token punctuation">,</span> <span class="token comment">// 邮件主题</span>
  <span class="token comment">/**
   * @description: 收信人详细
   */</span>
  EmailToArr<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token constant">TO</span><span class="token operator">:</span> <span class="token string">'yuyehack@gmail.com'</span><span class="token punctuation">,</span> <span class="token comment">// 接收者邮箱地址</span>
      <span class="token constant">CITY</span><span class="token operator">:</span> <span class="token string">'jiangsu'</span><span class="token punctuation">,</span> <span class="token comment">// 墨迹天气链接末尾城市代码</span>
      <span class="token constant">LOCATION</span><span class="token operator">:</span> <span class="token string">'pukou-district'</span><span class="token punctuation">,</span> <span class="token comment">// 墨迹天气链接末尾详细地区代码</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token constant">TO</span><span class="token operator">:</span> <span class="token string">'yuyehack@qq.com'</span><span class="token punctuation">,</span>
      <span class="token constant">CITY</span><span class="token operator">:</span> <span class="token string">'jiangsu'</span><span class="token punctuation">,</span>
      <span class="token constant">LOCATION</span><span class="token operator">:</span> <span class="token string">'kunshan'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">//每日发送时间</span>
  <span class="token constant">SENDDATE</span><span class="token operator">:</span> <span class="token string">'58 15 8 * * *'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="③-运行"><a href="#③-运行" class="header-anchor">#</a> ③ 运行</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span> start
</code></pre></div><h2 id="代码详解"><a href="#代码详解" class="header-anchor">#</a> 代码详解</h2> <blockquote><p>具体代码可见 https://github.com/cyea/email-bot.git</p></blockquote> <p>先展示下项目结构</p> <div class="language- extra-class"><pre class="language-text"><code>├─config
│      index.js #配置
│
├─email
│      index.js #发送邮件模块
│
├─superagent
│      index.js #获取天气及ONE 数据
│
├─utils
│      index.js #通用工具函数
│      superagent.js #请求发送封装
│
├─view
|        index.js #生成邮件样式模块
|        index.njk #邮件样式模板模块
│  .env.example #.env
│  index.js #服务启动模块
│  schedule.js #定时模块
│  test.js #模板样式调试模块
│  yarn.lock
│  .gitignore
│  LICENSE
│  package.json
│  README.md
</code></pre></div><h3 id="_1-爬取数据"><a href="#_1-爬取数据" class="header-anchor">#</a> 1. 爬取数据</h3> <p>使用 superagent 和 cheerio 组合来实现爬虫</p> <h4 id="①-superagent-使用"><a href="#①-superagent-使用" class="header-anchor">#</a> ① superagent 使用</h4> <p>因为多次两次使用的<code>superagent</code> 函数代码结构类似 所以我再把 <code>superagent</code> 封装了一次 <code>Promise</code> 抛出 <code>fetch</code>方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// utils/superagent.js</span>
<span class="token keyword">const</span> superagent <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'superagent'</span><span class="token punctuation">)</span>
<span class="token comment">//请求</span>
<span class="token keyword">function</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> method<span class="token punctuation">,</span> params<span class="token punctuation">,</span> data<span class="token punctuation">,</span> cookies</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">superagent</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> fetch
</code></pre></div><h4 id="②-数据爬取"><a href="#②-数据爬取" class="header-anchor">#</a> ② 数据爬取</h4> <ul><li>爬取 ONE</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">getOne</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取每日一句</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token constant">ONE</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token comment">//转化成类似jquery结构</span>
  <span class="token keyword">let</span> todayOneList <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#carousel-one .carousel-inner .item'</span><span class="token punctuation">)</span>
  <span class="token comment">// 通过查看DOM获取今日句子</span>
  <span class="token keyword">let</span> info <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>todayOneList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.fp-one-cita'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/(^\s*)|(\s*$)/g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> imgSrc <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>todayOneList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.fp-one-imagen'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token comment">// 抛出 one 对象</span>
    one<span class="token operator">:</span> <span class="token punctuation">{</span>
      info<span class="token punctuation">,</span>
      imgSrc<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>爬取天气</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">getWeather</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">city<span class="token punctuation">,</span> location</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//获取墨迹天气</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token constant">MOJI_HOST</span> <span class="token operator">+</span> city <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> location <span class="token comment">// 根据配置得到天气url</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
  <span class="token comment">//获取墨迹天气地址</span>
  <span class="token keyword">let</span> addressText <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.search_default'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'， '</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span>
  <span class="token comment">//获取墨迹天气提示</span>
  <span class="token keyword">let</span> weatherTip <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.wea_tips em'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">//  获取现在的天气数据</span>
  <span class="token keyword">const</span> now <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.wea_weather.clearfix'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> nowInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
    Temp<span class="token operator">:</span> now<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'em'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    WeatherText<span class="token operator">:</span> now<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    FreshText<span class="token operator">:</span> now<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.info_uptime'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 循环获取未来三天数据</span>
  <span class="token keyword">let</span> threeDaysData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.forecast .days'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> elem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 循环获取未来几天天气数据</span>
    <span class="token keyword">const</span> SingleDay <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span>
    threeDaysData<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      Day<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span>SingleDay<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/(^\s*)|(\s*$)/g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      WeatherImgUrl<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span>SingleDay<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      WeatherText<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span>SingleDay<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/(^\s*)|(\s*$)/g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      Temperature<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span>SingleDay<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/(^\s*)|(\s*$)/g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      WindDirection<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span>SingleDay<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'em'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/(^\s*)|(\s*$)/g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      WindLevel<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span>SingleDay<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/(^\s*)|(\s*$)/g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      Pollution<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span>SingleDay<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/(^\s*)|(\s*$)/g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      PollutionLevel<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span>SingleDay<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'strong'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    moji<span class="token operator">:</span> <span class="token punctuation">{</span>
      addressText<span class="token punctuation">,</span>
      weatherTip<span class="token punctuation">,</span>
      nowInfo<span class="token punctuation">,</span>
      threeDaysData<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="③-数据合并"><a href="#③-数据合并" class="header-anchor">#</a> ③ 数据合并</h4> <p>异步获取两个数据</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">getAllData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">city<span class="token punctuation">,</span> location</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> oneData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> weatherData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getWeather</span><span class="token punctuation">(</span>city<span class="token punctuation">,</span> location<span class="token punctuation">)</span>
  <span class="token keyword">const</span> allData <span class="token operator">=</span> <span class="token punctuation">{</span> today<span class="token operator">:</span> <span class="token function">formatDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>oneData<span class="token punctuation">,</span> <span class="token operator">...</span>weatherData <span class="token punctuation">}</span>
  <span class="token keyword">return</span> allData
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> getAllData
</code></pre></div><h3 id="_2-模版引擎生成-html"><a href="#_2-模版引擎生成-html" class="header-anchor">#</a> 2. 模版引擎生成 HTML</h3> <h4 id="①-模板编写"><a href="#①-模板编写" class="header-anchor">#</a> ① 模板编写</h4> <p>ejs 这种模板已经年老 更新不及时，所以换了更清晰更新的 nunjucks 因为邮件不支持外链 css 所以使用内联 css 虽然比较麻烦</p> <p>使用刚获取到数据 模板渲染</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- index.njk --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><span class="token property">max-width</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> 40px auto<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span>20px<span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span>#5f5e5e<span class="token punctuation">;</span><span class="token property">text-align</span><span class="token punctuation">:</span>center</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>今天是{{today}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> 20px auto<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span>16px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#2bbc8a<span class="token punctuation">;</span><span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">font-family</span><span class="token punctuation">:</span> Arial<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span><span class="token property">line-height</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{moji.nowInfo.Temp}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">vertical-align</span><span class="token punctuation">:</span> top<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>℃<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">font-size</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span><span class="token property">padding-top</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{moji.nowInfo.WeatherText}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">text-align</span><span class="token punctuation">:</span>center<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span>12px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#d480aa</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{moji.addressText}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dev</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> 0 auto<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#5f5e5e<span class="token punctuation">;</span><span class="token property">text-align</span><span class="token punctuation">:</span>center</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span>block<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#676767<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span>20px</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{moji.weatherTip}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span>block<span class="token punctuation">;</span><span class="token property">margin-top</span><span class="token punctuation">:</span>15px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#676767<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span>15px</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>近期天气预报<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
            {% for item in moji.threeDaysData %}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span><span class="token property">margin-top</span><span class="token punctuation">:</span>5px<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span><span class="token property">line-height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span><span class="token property">justify-content</span><span class="token punctuation">:</span> space-around<span class="token punctuation">;</span><span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span>15%<span class="token punctuation">;</span> <span class="token property">text-align</span><span class="token punctuation">:</span>center<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ item.Day }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span>25%<span class="token punctuation">;</span> <span class="token property">text-align</span><span class="token punctuation">:</span>center<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">height</span><span class="token punctuation">:</span>26px<span class="token punctuation">;</span><span class="token property">vertical-align</span><span class="token punctuation">:</span>middle<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>{{ item.WeatherImgUrl }}<span class="token punctuation">'</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span>inline-block</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ item.WeatherText }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span>25%<span class="token punctuation">;</span> <span class="token property">text-align</span><span class="token punctuation">:</span>center<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ item.Temperature }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                {% if (item.PollutionLevel==='level_1') %}
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span>35%<span class="token punctuation">;</span> </span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span>inline-block<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span>0 8px<span class="token punctuation">;</span><span class="token property">line-height</span><span class="token punctuation">:</span>25px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#8fc31f<span class="token punctuation">;</span> <span class="token property">border-radius</span><span class="token punctuation">:</span>15px<span class="token punctuation">;</span> <span class="token property">text-align</span><span class="token punctuation">:</span>center<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ item.Pollution }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                {% elif (item.PollutionLevel==='level_2') %}
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span>35%<span class="token punctuation">;</span> </span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span>inline-block<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span>0 8px<span class="token punctuation">;</span><span class="token property">line-height</span><span class="token punctuation">:</span>25px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#d7af0e<span class="token punctuation">;</span> <span class="token property">border-radius</span><span class="token punctuation">:</span>15px<span class="token punctuation">;</span> <span class="token property">text-align</span><span class="token punctuation">:</span>center<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ item.Pollution }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                {% elif (item.PollutionLevel==='level_3') %}
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span>35%<span class="token punctuation">;</span> </span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span>inline-block<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span>0 8px<span class="token punctuation">;</span><span class="token property">line-height</span><span class="token punctuation">:</span>25px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#f39800<span class="token punctuation">;</span> <span class="token property">border-radius</span><span class="token punctuation">:</span>15px<span class="token punctuation">;</span> <span class="token property">text-align</span><span class="token punctuation">:</span>center<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ item.Pollution }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                {% elif (item.PollutionLevel==='level_4') %}
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span>35%<span class="token punctuation">;</span> </span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span>inline-block<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span>0 8px<span class="token punctuation">;</span><span class="token property">line-height</span><span class="token punctuation">:</span>25px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#e2361a<span class="token punctuation">;</span> <span class="token property">border-radius</span><span class="token punctuation">:</span>15px<span class="token punctuation">;</span> <span class="token property">text-align</span><span class="token punctuation">:</span>center<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ item.Pollution }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                {% elif (item.PollutionLevel==='level_5') %}
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span>35%<span class="token punctuation">;</span> </span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span>inline-block<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span>0 8px<span class="token punctuation">;</span><span class="token property">line-height</span><span class="token punctuation">:</span>25px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#5f52a0<span class="token punctuation">;</span> <span class="token property">border-radius</span><span class="token punctuation">:</span>15px<span class="token punctuation">;</span> <span class="token property">text-align</span><span class="token punctuation">:</span>center<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ item.Pollution }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                {% elif (item.PollutionLevel==='level_6') %}
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span>35%<span class="token punctuation">;</span> </span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span>inline-block<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span>0 8px<span class="token punctuation">;</span><span class="token property">line-height</span><span class="token punctuation">:</span>25px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#631541<span class="token punctuation">;</span> <span class="token property">border-radius</span><span class="token punctuation">:</span>15px<span class="token punctuation">;</span> <span class="token property">text-align</span><span class="token punctuation">:</span>center<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ item.Pollution }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                {% else  %}
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span>35%<span class="token punctuation">;</span> </span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span>inline-block<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span>0 8px<span class="token punctuation">;</span><span class="token property">line-height</span><span class="token punctuation">:</span>25px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#631541<span class="token punctuation">;</span> <span class="token property">border-radius</span><span class="token punctuation">:</span>15px<span class="token punctuation">;</span> <span class="token property">text-align</span><span class="token punctuation">:</span>center<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>none<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                {% endif  %}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            {% endfor %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">text-align</span><span class="token punctuation">:</span>center<span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span>35px 0<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span>block<span class="token punctuation">;</span><span class="token property">margin-top</span><span class="token punctuation">:</span>55px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#676767<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span>15px</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ONE · 一个<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{ one.imgSrc }}<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">max-width</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span>10px auto<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span>  <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">color</span><span class="token punctuation">:</span>#b0b0b0<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span>13px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>摄影<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">margin</span><span class="token punctuation">:</span>10px auto<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span>85%<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#5f5e5e<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>{{one.info}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="②-模板渲染"><a href="#②-模板渲染" class="header-anchor">#</a> ② 模板渲染</h4> <p>node fs 模块 读取本地模板文件 抛出 渲染好的 html 结构数据</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> nunjucks <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'nunjucks'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">getHtmlData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">njkData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> njkString <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>
        path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'index.njk'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'utf8'</span>
      <span class="token punctuation">)</span>
      <span class="token keyword">const</span> htmlData <span class="token operator">=</span> nunjucks<span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>njkString<span class="token punctuation">,</span> njkData<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>htmlData<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> getHtmlData
</code></pre></div><h3 id="_3-使用-node-发送邮件"><a href="#_3-使用-node-发送邮件" class="header-anchor">#</a> 3. 使用 Node 发送邮件</h3> <p>这里使用 <code>nodemailer</code></p> <p><strong>注意的是邮箱密码不是你登录邮箱的密码，而是 smtp 授权码，什么是 smtp 授权码呢？就是你的邮箱账号可以使用这个 smtp 授权码在别的地方发邮件，一般 smtp 授权码在邮箱官网的设置中可以看的到.不知道的话可以使用邮箱账号及密码试试</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./../config'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">sendMail</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">transporter<span class="token punctuation">,</span> To<span class="token punctuation">,</span> HtmlData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> mailOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token keyword">from</span><span class="token operator">:</span> config<span class="token punctuation">.</span>EmailFrom<span class="token punctuation">,</span> <span class="token comment">// 发送者邮箱</span>
      to<span class="token operator">:</span> To<span class="token punctuation">,</span> <span class="token comment">// 接收邮箱</span>
      subject<span class="token operator">:</span> config<span class="token punctuation">.</span>EmailSubject<span class="token punctuation">,</span> <span class="token comment">// // 邮件主题</span>
      html<span class="token operator">:</span> HtmlData<span class="token punctuation">,</span> <span class="token comment">//模板数据</span>
    <span class="token punctuation">}</span>
    transporter<span class="token punctuation">.</span><span class="token function">sendMail</span><span class="token punctuation">(</span>mailOptions<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> info <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'邮件发送成功'</span> <span class="token operator">+</span> error<span class="token punctuation">)</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'邮件发送成功'</span><span class="token punctuation">,</span> info<span class="token punctuation">.</span>messageId<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'静等下一次发送'</span><span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> sendMail
</code></pre></div><h3 id="_4-整合运行"><a href="#_4-整合运行" class="header-anchor">#</a> 4. 整合运行</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> transporter <span class="token operator">=</span> nodemailer<span class="token punctuation">.</span><span class="token function">createTransport</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  service<span class="token operator">:</span> EmianService<span class="token punctuation">,</span>
  port<span class="token operator">:</span> <span class="token number">465</span><span class="token punctuation">,</span>
  secureConnection<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  auth<span class="token operator">:</span> EamilAuth<span class="token punctuation">,</span>
  pool<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">getAllDataAndSendMail</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> EmailToArr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> item <span class="token operator">=</span> EmailToArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">let</span> apiData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getAllData</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token constant">CITY</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token constant">LOCATION</span><span class="token punctuation">)</span>
      <span class="token keyword">let</span> htmlData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getHtmlData</span><span class="token punctuation">(</span>apiData<span class="token punctuation">)</span>
      <span class="token keyword">await</span> <span class="token function">sendMail</span><span class="token punctuation">(</span>transporter<span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token constant">TO</span><span class="token punctuation">,</span> htmlData<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">getAllDataAndSendMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_5-定时"><a href="#_5-定时" class="header-anchor">#</a> 5. 定时</h3> <p>这里用到了 <code>node-schedule</code> 来定时执行任务,它跟 <code>corn</code> 很类似 之不是基于<code>Node</code>的
具体用法可见 <code>node-schedule</code>文档
这里我使用了 每天早上的 08:15:58 定时发送 <strong>尽量不取整点</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> schedule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-schedule'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./config'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">scheduleRun</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'NodeMail: 开始等待目标时刻...'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> j <span class="token operator">=</span> schedule<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token constant">SENDDATE</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// SENDDATE: &quot;58 15 8 * * *&quot;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'开始执行任务......'</span><span class="token punctuation">)</span>
    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> scheduleRun
</code></pre></div><p>所以只要 引入<code>scheduleRun</code>方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">scheduleRun</span><span class="token punctuation">(</span>getAllDataAndSendMail<span class="token punctuation">)</span>
</code></pre></div><h3 id="_6-配置详情"><a href="#_6-配置详情" class="header-anchor">#</a> 6. 配置详情</h3> <p>因为像邮件 smtp 授权码 是敏感信息 建议放进环境变量 <code>env2</code> 是个不错的工具 ,具体使用可以看<code>env2</code>文档</p> <p><strong>具体配置详见<a href="/posts/713d3487/#配置">这里</a></strong></p> <h2 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h2> <h3 id="_1-邮箱登陆失败"><a href="#_1-邮箱登陆失败" class="header-anchor">#</a> 1. 邮箱登陆失败</h3> <p>一般是在服务器上运行时,邮箱提供商安全机制 会阻止异地登陆 ,只要去邮箱提供商允许就可以了</p> <h3 id="_2-发送失败"><a href="#_2-发送失败" class="header-anchor">#</a> 2. 发送失败</h3> <p>因为多人定制因为邮件内容不一样,所以不是同一封邮件,会额外开辟一个线程发送,可能会超过邮件提供商允许线程</p></div></article> <section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      发布时间 : 2019-04-10
    </span> <span class="update-date" data-v-4e23451f>
      最后修改 : 2020-08-11
    </span></section> <section class="post-links" data-v-4e23451f><a href="/posts/2019/01/21/a.html" class="post-link" data-v-4e23451f>
      上一篇 : Hello, world!
    </a> <!----></section></section> <!----></div></main> <aside class="aside" data-v-4dd605a1><div class="info-card main-div" data-v-9d847660 data-v-4dd605a1><div class="info-card-header" data-v-9d847660><img src="https://elem.fun/usr/themes/Minimalist/avatar.png" alt="cyea" class="info-avatar" data-v-9d847660></div> <div class="info-card-body" data-v-9d847660><section class="info-nickname" data-v-9d847660>
      cyea
    </section> <section class="info-desc" data-v-9d847660>Happy Coding<br/>Happy Life</section> <section class="info-contact" data-v-9d847660><section data-v-9d847660><span title="Nanjing City, China" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>Nanjing City, China</title><use xlink:href="#icon-location" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          Nanjing City, China
        </span></span></section> <!----> <section data-v-9d847660><a href="mailto:yuyehack@gmail.com" title="yuyehack@gmail.com" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>yuyehack@gmail.com</title><use xlink:href="#icon-email" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          yuyehack@gmail.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-9d847660><section class="info-sns clearfix" data-v-9d847660><a href="https://github.com/cyea" target="_blank" class="sns-link" data-v-9d847660><span title="GitHub: cyea" class="sns-icon" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1.5em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>GitHub: cyea</title><use xlink:href="#icon-github" data-v-9d847660 data-v-9d847660></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-4dd605a1><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span>文章目录</span> <div class="post-nav-toc"><ul><li><a href="/posts/2019/04/10/asd.html#效果展示">效果展示</a></li><li><a href="/posts/2019/04/10/asd.html#如何快速使用">如何快速使用</a><ul><li><a href="/posts/2019/04/10/asd.html#_1-拉取代码安装依赖">1. 拉取代码安装依赖</a></li><li><a href="/posts/2019/04/10/asd.html#_2-配置">2. 配置</a></li></ul></li><li><a href="/posts/2019/04/10/asd.html#代码详解">代码详解</a><ul><li><a href="/posts/2019/04/10/asd.html#_1-爬取数据">1. 爬取数据</a></li><li><a href="/posts/2019/04/10/asd.html#_2-模版引擎生成-html">2. 模版引擎生成 HTML</a></li><li><a href="/posts/2019/04/10/asd.html#_3-使用-node-发送邮件">3. 使用 Node 发送邮件</a></li><li><a href="/posts/2019/04/10/asd.html#_4-整合运行">4. 整合运行</a></li><li><a href="/posts/2019/04/10/asd.html#_5-定时">5. 定时</a></li><li><a href="/posts/2019/04/10/asd.html#_6-配置详情">6. 配置详情</a></li></ul></li><li><a href="/posts/2019/04/10/asd.html#问题">问题</a><ul><li><a href="/posts/2019/04/10/asd.html#_1-邮箱登陆失败">1. 邮箱登陆失败</a></li><li><a href="/posts/2019/04/10/asd.html#_2-发送失败">2. 发送失败</a></li></ul></li></ul></div></div> <!----></div></aside></div> <footer class="footer" data-v-1375e54c><p class="footer-sns-links" data-v-1375e54c><a href="https://github.com/cyea" target="_blank" class="sns-link" data-v-1375e54c><span title="GitHub: cyea" class="sns-icon" data-v-1375e54c data-v-1375e54c><svg class="icon" style="font-size:25px;" data-v-1375e54c data-v-1375e54c><title data-v-1375e54c data-v-1375e54c>GitHub: cyea</title><use xlink:href="#icon-github" data-v-1375e54c data-v-1375e54c></use></svg></span></a></p> <p class="footer-text" data-v-1375e54c><span data-v-1375e54c>Powered by </span> <a href="https://github.com/vuejs/vuepress" target="_blank" data-v-1375e54c>
      VuePress
    </a> <span data-v-1375e54c> | </span> <a href="https://github.com/meteorlxy/vuepress-theme-meteorlxy" target="_blank" data-v-1375e54c>
        meteorlxy
      </a></p> <p class="footer-text" data-v-1375e54c>Copyright 2020</p></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.3c4192dc.js" defer></script><script src="/assets/js/7.09f10cf6.js" defer></script><script src="/assets/js/15.55f1b48f.js" defer></script>
  </body>
</html>
